<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SilverStrength Pro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary: #1e293b;       /* Slate 800 */
            --accent: #2563eb;        /* Blue 600 */
            --accent-soft: #dbeafe;   /* Blue 100 */
            --success: #10b981;       /* Emerald 500 */
            --bg: #f8fafc;            /* Slate 50 */
            --card: #ffffff;
            --text-main: #334155;
            --text-light: #64748b;
            --border: #e2e8f0;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            padding-bottom: 90px; /* Space for nav */
            height: 100vh;
        }

        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        
        /* Typography */
        h1 { font-size: 1.6rem; color: var(--primary); margin: 0 0 10px 0; }
        h2 { font-size: 1.3rem; margin: 20px 0 10px 0; }
        h3 { font-size: 1.1rem; margin: 0 0 10px 0; font-weight: 600; }
        p { color: var(--text-light); line-height: 1.6; margin-top: 0; font-size: 0.95rem; }

        /* Cards */
        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }

        /* --- ONBOARDING SCREEN --- */
        #view-onboarding {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--card);
            z-index: 200;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 40px;
        }
        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary); }
        .std-input {
            width: 100%; padding: 15px; border-radius: 10px; border: 1px solid var(--border);
            font-size: 1.1rem; background: var(--bg);
        }

        /* --- DASHBOARD --- */
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .avatar {
            width: 45px; height: 45px; background: var(--primary); color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
        }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-card { background: var(--accent-soft); padding: 15px; border-radius: 12px; text-align: center; }
        .stat-val { font-size: 1.6rem; font-weight: 800; color: var(--accent); }
        .stat-lbl { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-light); }

        /* --- CALENDAR --- */
        .calendar-grid {
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center;
        }
        .cal-head { font-weight: bold; font-size: 0.8rem; padding-bottom: 10px; color: var(--text-light); }
        .cal-cell {
            height: 40px; display: flex; align-items: center; justify-content: center;
            border-radius: 8px; font-size: 0.9rem; position: relative;
        }
        .cal-cell.today { border: 2px solid var(--accent); font-weight: bold; }
        .cal-cell.workout-done { background-color: var(--success); color: white; }
        .cal-cell.empty { background: transparent; }

        /* --- GUIDE / LIBRARY --- */
        .guide-item { padding: 15px 0; border-bottom: 1px solid var(--border); }
        .guide-item:last-child { border-bottom: none; }
        .guide-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 5px; color: var(--primary); }
        .badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.7rem; background: #e2e8f0; margin-bottom: 8px;}
        .why-box { background: #f0fdf4; padding: 10px; border-radius: 8px; margin-top: 8px; border-left: 3px solid var(--success); }
        .why-text { font-size: 0.85rem; color: #166534; margin: 0; }

        /* --- ACTIVE WORKOUT --- */
        #active-workout-view {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--card);
            z-index: 100; display: none; flex-direction: column; padding: 20px;
        }
        #active-workout-view.visible { display: flex; }
        
        .timer-display { font-size: 5rem; font-weight: 800; color: var(--primary); margin: 20px 0; font-variant-numeric: tabular-nums; }
        .rep-display { font-size: 4rem; font-weight: 800; color: var(--accent); margin: 20px 0; }
        
        /* --- BUTTONS --- */
        .btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-weight: 600; font-size: 1rem; cursor: pointer; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-accent { background: var(--accent); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-ghost { background: transparent; border: 2px solid var(--border); color: var(--text-light); }

        /* --- NAV BAR --- */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 75px;
            background: var(--card); border-top: 1px solid var(--border);
            display: flex; justify-content: space-around; align-items: center; z-index: 50;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; border: none; background: none;
            color: var(--text-light); font-size: 0.7rem; cursor: pointer; width: 100%;
        }
        .nav-item i { font-size: 1.4rem; margin-bottom: 5px; transition: 0.2s; }
        .nav-item.active { color: var(--accent); }
        .nav-item.active i { transform: translateY(-2px); }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="view-onboarding" class="hidden">
        <h1 style="text-align: center; margin-bottom: 10px;">Welcome to SilverStrength</h1>
        <p style="text-align: center; margin-bottom: 30px;">Your personalized path to mobility and strength.</p>
        
        <div class="input-group">
            <label>What should we call you?</label>
            <input type="text" id="inp-name" class="std-input" placeholder="e.g. John">
        </div>

        <div class="input-group">
            <label>Current Weight (lbs)</label>
            <input type="number" id="inp-weight" class="std-input" placeholder="e.g. 200">
        </div>

        <button class="btn btn-accent" onclick="completeOnboarding()">Start My Journey</button>
    </div>

    <div id="view-dashboard" class="container">
        <div class="header-row">
            <div>
                <h1 id="dash-greeting">Hello, User</h1>
                <p>Ready to move today?</p>
            </div>
            <div class="avatar"><i class="fas fa-user"></i></div>
        </div>

        <div class="stat-grid">
            <div class="stat-card">
                <div class="stat-val" id="dash-streak">0</div>
                <div class="stat-lbl">Workout Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-val" id="dash-weight">--</div>
                <div class="stat-lbl">Current Weight</div>
            </div>
        </div>

        <div class="card">
            <div class="header-row" style="margin-bottom:10px;">
                <h3>Today's Plan</h3>
                <span style="font-size:0.8rem; color:var(--text-light);" id="current-date-disp"></span>
            </div>
            <div id="recommendation-area">
                </div>
        </div>
    </div>

    <div id="view-history" class="container hidden">
        <h1>Your History</h1>
        <p>Consistency is the key to longevity.</p>

        <div class="card">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <h3 id="cal-month-name">Month</h3>
            </div>
            <div class="calendar-grid">
                <div class="cal-head">S</div><div class="cal-head">M</div><div class="cal-head">T</div>
                <div class="cal-head">W</div><div class="cal-head">T</div><div class="cal-head">F</div><div class="cal-head">S</div>
            </div>
            <div class="calendar-grid" id="calendar-body">
                </div>
        </div>

        <div class="card">
            <h3>Recent Activity</h3>
            <ul id="history-list" style="padding-left: 20px; color: var(--text-main);">
                </ul>
        </div>
    </div>

    <div id="view-tracker" class="container hidden">
        <h1>Weight Tracker</h1>
        <p>Monitor your trends over time.</p>

        <div class="card">
            <canvas id="weightChart" width="400" height="250"></canvas>
        </div>

        <div class="card">
            <h3>Log New Weight</h3>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="tracker-input" class="std-input" placeholder="lbs" style="flex:1;">
                <button class="btn btn-primary" style="width: auto;" onclick="addWeightLog()">Log</button>
            </div>
        </div>
    </div>

    <div id="view-guide" class="container hidden">
        <h1>Exercise Guide</h1>
        <p>Understanding the 'How' and the 'Why'.</p>
        
        <div class="card" id="guide-container">
            </div>
    </div>

    <div id="active-workout-view">
        <div class="header-row">
            <button class="btn-ghost" style="width:auto; padding:8px 15px;" onclick="quitWorkout()">Quit</button>
            <div style="font-weight:bold; color:var(--text-light);" id="act-routine-name">Routine A</div>
            <div style="width:50px;"></div>
        </div>

        <div style="flex:1; display:flex; flex-direction:column; justify-content:center; text-align:center;">
            <div style="color:var(--accent); font-weight:bold; letter-spacing:1px; margin-bottom:10px;">CURRENT EXERCISE</div>
            <h1 id="act-name" style="font-size:2.2rem; line-height:1.2;">Name</h1>
            <p id="act-desc" style="max-width:400px; margin:0 auto 20px auto;">Description</p>
            
            <div id="act-display-area"></div>
        </div>

        <div style="padding-bottom:20px;">
            <button class="btn btn-success" id="act-btn" onclick="nextExercise()">Start</button>
        </div>
    </div>

    <div class="nav-bar">
        <button class="nav-item active" onclick="switchTab('dashboard')">
            <i class="fas fa-home"></i> Home
        </button>
        <button class="nav-item" onclick="switchTab('history')">
            <i class="fas fa-calendar-alt"></i> History
        </button>
        <button class="nav-item" onclick="switchTab('tracker')">
            <i class="fas fa-chart-line"></i> Weight
        </button>
        <button class="nav-item" onclick="switchTab('guide')">
            <i class="fas fa-book-medical"></i> Guide
        </button>
    </div>

    <script>
        /* --- DATA MODEL --- */
        const defaultState = {
            user: { name: "", startWeight: 0, currentWeight: 0, joinedDate: "" },
            history: [], // { date: "YYYY-MM-DD", routine: "A" }
            weightLogs: [], // { date: "YYYY-MM-DD", weight: 200 }
            onboardingComplete: false
        };

        let appState = JSON.parse(localStorage.getItem('SilverStrengthPro_v1')) || defaultState;

        // Exercise Database with "Why" for 60yo demographics
        const exerciseDB = {
            "March in Place": {
                desc: "Lift knees high while swinging arms.",
                why: "Increases heart rate safely. Improves blood flow to joints before loading them.",
                type: "time", val: 60
            },
            "Wall Push-ups": {
                desc: "Stand arm-length from wall. Lean in, push back.",
                why: "Builds upper body bone density and chest strength without the wrist strain of floor pushups.",
                type: "reps", val: 12
            },
            "Chair Squats": {
                desc: "Sit back to tap the chair, then stand up tall.",
                why: "Vital for independence. Strengthens quads to protect knees and hips.",
                type: "reps", val: 12
            },
            "Plank Support": {
                desc: "Forearms on wall/chair. Keep body straight.",
                why: "Stabilizes the core to protect the lower back from injury.",
                type: "time", val: 30
            },
            "Bird Dog": {
                desc: "Hands/Knees. Extend opposite arm/leg.",
                why: "Improves balance and spinal health to prevent falls.",
                type: "reps", val: 10
            },
            "Step Ups": {
                desc: "Step up onto a bottom stair, then down.",
                why: "Unilateral leg strength corrects imbalances and significantly reduces fall risk.",
                type: "reps", val: 10
            },
            "Wall Angels": {
                desc: "Back to wall. Slide arms up and down.",
                why: "Counteracts hunching. Improves thoracic mobility for better posture.",
                type: "reps", val: 10
            },
            "Single Leg Stand": {
                desc: "Hold chair. Lift one foot. Balance.",
                why: "Directly trains the balance systems in the inner ear and ankles.",
                type: "time", val: 20
            }
        };

        const routines = {
            'A': ["March in Place", "Wall Push-ups", "Chair Squats", "Plank Support", "Bird Dog"],
            'B': ["March in Place", "Step Ups", "Wall Angels", "Chair Squats", "Single Leg Stand"]
        };

        let activeWorkout = [];
        let activeIndex = 0;
        let timerInt;
        let timeLeft;
        let isPaused = false;
        let chartInstance = null;

        /* --- INITIALIZATION --- */
        window.onload = () => {
            if(!appState.onboardingComplete) {
                document.getElementById('view-onboarding').classList.remove('hidden');
            } else {
                initApp();
            }
        };

        function completeOnboarding() {
            const name = document.getElementById('inp-name').value;
            const w = document.getElementById('inp-weight').value;
            if(!name || !w) return alert("Please fill in the fields.");

            appState.user.name = name;
            appState.user.startWeight = parseFloat(w);
            appState.user.currentWeight = parseFloat(w);
            appState.user.joinedDate = new Date().toISOString().split('T')[0];
            appState.weightLogs.push({ date: appState.user.joinedDate, weight: parseFloat(w) });
            appState.onboardingComplete = true;
            
            saveData();
            document.getElementById('view-onboarding').classList.add('hidden');
            initApp();
        }

        function initApp() {
            document.getElementById('dash-greeting').innerText = `Hello, ${appState.user.name}`;
            updateDashboard();
            renderGuide();
        }

        function saveData() {
            localStorage.setItem('SilverStrengthPro_v1', JSON.stringify(appState));
        }

        function switchTab(tab) {
            document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(`view-${tab}`).classList.remove('hidden');
            
            // Highlight icon
            const idx = ['dashboard','history','tracker','guide'].indexOf(tab);
            document.querySelectorAll('.nav-item')[idx].classList.add('active');

            if(tab === 'dashboard') updateDashboard();
            if(tab === 'history') renderCalendar();
            if(tab === 'tracker') renderChart();
        }

        /* --- DASHBOARD --- */
        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const hasDone = appState.history.some(h => h.date === today);
            
            // Streak Calc
            // (Simplified streak for demo: just count total workouts)
            document.getElementById('dash-streak').innerText = appState.history.length; 
            document.getElementById('dash-weight').innerText = appState.user.currentWeight;
            document.getElementById('current-date-disp').innerText = new Date().toDateString();

            const recArea = document.getElementById('recommendation-area');
            if(hasDone) {
                recArea.innerHTML = `
                    <div style="background:#ecfdf5; border:1px solid #10b981; color:#065f46; padding:15px; border-radius:10px; text-align:center;">
                        <i class="fas fa-check-circle" style="font-size:1.5rem; margin-bottom:5px;"></i><br>
                        <strong>Workout Complete!</strong><br>Great job today.
                    </div>
                `;
            } else {
                // Alternate based on Day of Month (Even=A, Odd=B)
                const dayNum = new Date().getDate();
                const rKey = (dayNum % 2 === 0) ? 'A' : 'B';
                const rName = rKey === 'A' ? "Foundation Strength" : "Mobility & Balance";
                
                recArea.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div class="badge" style="background:var(--accent-soft); color:var(--accent);">Recommended</div>
                            <div style="font-weight:bold; font-size:1.1rem; margin-top:5px;">${rName}</div>
                            <div style="font-size:0.85rem; color:var(--text-light);">~20 Minutes â€¢ Low Impact</div>
                        </div>
                        <button class="btn btn-primary" style="width:auto; padding:10px 20px;" onclick="startWorkout('${rKey}')">Start</button>
                    </div>
                `;
            }
        }

        /* --- CALENDAR LOGIC --- */
        function renderCalendar() {
            const date = new Date();
            const year = date.getFullYear();
            const month = date.getMonth(); // 0-11
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            document.getElementById('cal-month-name').innerText = firstDay.toLocaleString('default', { month: 'long', year: 'numeric' });
            
            const grid = document.getElementById('calendar-body');
            grid.innerHTML = "";

            // Empty slots for days before 1st
            for(let i=0; i<firstDay.getDay(); i++) {
                grid.innerHTML += `<div class="cal-cell empty"></div>`;
            }

            // Days
            for(let d=1; d<=lastDay.getDate(); d++) {
                const checkDate = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const isToday = checkDate === new Date().toISOString().split('T')[0];
                const isDone = appState.history.some(h => h.date === checkDate);
                
                grid.innerHTML += `
                    <div class="cal-cell ${isToday?'today':''} ${isDone?'workout-done':''}">
                        ${d}
                    </div>
                `;
            }

            // List history
            const list = document.getElementById('history-list');
            list.innerHTML = "";
            const recent = [...appState.history].reverse().slice(0, 5);
            if(recent.length === 0) list.innerHTML = "<li>No workouts yet.</li>";
            recent.forEach(h => {
                list.innerHTML += `<li style="margin-bottom:5px;"><span style="color:var(--text-light); font-size:0.9rem;">${h.date}:</span> <strong>Routine ${h.routine}</strong></li>`;
            });
        }

        /* --- CHART JS --- */
        function renderChart() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            
            // Prepare Data
            const labels = appState.weightLogs.map(l => l.date);
            const data = appState.weightLogs.map(l => l.weight);

            if(chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Weight (lbs)',
                        data: data,
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: false } // Focus on the range
                    }
                }
            });
        }

        function addWeightLog() {
            const val = document.getElementById('tracker-input').value;
            if(!val) return;
            
            const today = new Date().toISOString().split('T')[0];
            appState.weightLogs.push({ date: today, weight: parseFloat(val) });
            appState.user.currentWeight = parseFloat(val);
            saveData();
            
            document.getElementById('tracker-input').value = "";
            renderChart();
        }

        /* --- GUIDE RENDERER --- */
        function renderGuide() {
            const container = document.getElementById('guide-container');
            container.innerHTML = "";
            
            for (const [name, info] of Object.entries(exerciseDB)) {
                container.innerHTML += `
                    <div class="guide-item">
                        <div class="guide-title">${name}</div>
                        <div style="font-size:0.9rem;">${info.desc}</div>
                        <div class="why-box">
                            <p class="why-text"><strong>Beneficial Because:</strong> ${info.why}</p>
                        </div>
                    </div>
                `;
            }
        }

        /* --- WORKOUT ENGINE --- */
        function startWorkout(rKey) {
            activeWorkout = routines[rKey];
            activeIndex = 0;
            document.getElementById('active-workout-view').classList.add('visible');
            document.getElementById('act-routine-name').innerText = `Routine ${rKey}`;
            loadActiveExercise();
        }

        function loadActiveExercise() {
            if(activeIndex >= activeWorkout.length) {
                finishWorkout();
                return;
            }

            const exName = activeWorkout[activeIndex];
            const exData = exerciseDB[exName];
            
            document.getElementById('act-name').innerText = exName;
            document.getElementById('act-desc').innerText = exData.desc;
            
            const area = document.getElementById('act-display-area');
            const btn = document.getElementById('act-btn');
            
            clearInterval(timerInt);

            if(exData.type === 'reps') {
                area.innerHTML = `<div class="rep-display">${exData.val} <span style="font-size:2rem;color:var(--text-light)">reps</span></div>`;
                btn.innerText = "Done";
                btn.className = "btn btn-success";
                btn.onclick = nextExercise;
            } else {
                timeLeft = exData.val;
                isPaused = false;
                area.innerHTML = `<div class="timer-display" id="timer-val">${formatTime(timeLeft)}</div>`;
                btn.innerText = "Start Timer";
                btn.className = "btn btn-primary";
                btn.onclick = toggleTimer;
            }
        }

        function toggleTimer() {
            const btn = document.getElementById('act-btn');
            if(btn.innerText === "Start Timer") {
                btn.innerText = "Pause";
                startTimerInterval();
            } else if (btn.innerText === "Pause") {
                isPaused = true;
                btn.innerText = "Resume";
            } else {
                isPaused = false;
                btn.innerText = "Pause";
            }
        }

        function startTimerInterval() {
            timerInt = setInterval(() => {
                if(!isPaused) {
                    timeLeft--;
                    document.getElementById('timer-val').innerText = formatTime(timeLeft);
                    if(timeLeft <= 0) {
                        clearInterval(timerInt);
                        // Haptic feedback
                        if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
                        nextExercise();
                    }
                }
            }, 1000);
        }

        function nextExercise() {
            activeIndex++;
            loadActiveExercise();
        }

        function formatTime(s) {
            return `00:${s.toString().padStart(2, '0')}`;
        }

        function quitWorkout() {
            if(confirm("Exit workout?")) {
                clearInterval(timerInt);
                document.getElementById('active-workout-view').classList.remove('visible');
            }
        }

        function finishWorkout() {
            clearInterval(timerInt);
            document.getElementById('active-workout-view').classList.remove('visible');
            
            const today = new Date().toISOString().split('T')[0];
            const rKey = (new Date().getDate() % 2 === 0) ? 'A' : 'B';

            // Only log if not already logged today (optional rule)
            if(!appState.history.some(h => h.date === today)) {
                appState.history.push({ date: today, routine: rKey });
                saveData();
            }
            
            alert("Workout Complete! Great job.");
            updateDashboard();
        }

    </script>
</body>
</html>
