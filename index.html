<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SilverStrength AI</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary: #0f172a; --secondary: #334155;
            --accent: #ef4444; /* Red for 'Burn'/Weight Loss focus */
            --accent-soft: #fee2e2;
            --success: #10b981; --bg: #f8fafc; --card: #ffffff;
            --text: #1e293b; --border: #e2e8f0;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 90px; }
        
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        h1, h2, h3 { margin: 0; }
        .hidden { display: none !important; }

        /* --- CARDS & UTILS --- */
        .card { background: var(--card); border-radius: 16px; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid var(--border); }
        .btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-weight: 700; font-size: 1rem; cursor: pointer; transition: 0.2s; }
        .btn-accent { background: var(--accent); color: white; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--border); color: var(--text); }

        /* --- DASHBOARD --- */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .avatar { width: 40px; height: 40px; background: var(--secondary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; }
        
        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-box { background: white; padding: 15px; border-radius: 12px; text-align: center; border: 1px solid var(--border); }
        .stat-num { font-size: 1.5rem; font-weight: 800; color: var(--primary); }
        .stat-lbl { font-size: 0.7rem; text-transform: uppercase; color: #64748b; font-weight: 600; letter-spacing: 0.5px; }

        /* --- AI RECOMMENDATION BOX --- */
        .ai-rec-box { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: white; border-radius: 16px; padding: 25px; position: relative; overflow: hidden; }
        .ai-badge { background: var(--accent); font-size: 0.7rem; padding: 4px 10px; border-radius: 20px; text-transform: uppercase; font-weight: bold; display: inline-block; margin-bottom: 10px; }
        .ai-reason { font-size: 0.85rem; opacity: 0.8; margin-top: 10px; line-height: 1.5; border-left: 2px solid var(--accent); padding-left: 10px; }

        /* --- WORKOUT LIST --- */
        .routine-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid var(--border); cursor: pointer; }
        
        /* --- ACTIVE WORKOUT MODE --- */
        #view-active { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--card); z-index: 100; overflow-y: auto; display: flex; flex-direction: column; }
        .active-header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: var(--bg); }
        .active-body { padding: 20px; flex: 1; }
        
        .timer-big { font-size: 4rem; font-weight: 800; text-align: center; margin: 20px 0; color: var(--primary); font-variant-numeric: tabular-nums; }
        .rep-big { font-size: 3.5rem; font-weight: 800; text-align: center; margin: 20px 0; color: var(--accent); }
        
        .form-check-card { background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 12px; padding: 15px; margin-top: 20px; }
        .form-title { font-weight: bold; color: #0369a1; margin-bottom: 8px; font-size: 0.9rem; text-transform: uppercase; }
        .form-list { margin: 0; padding-left: 20px; font-size: 0.95rem; color: #334155; }
        .form-list li { margin-bottom: 5px; }
        
        .mistake-card { background: #fef2f2; border: 1px solid #fecaca; border-radius: 12px; padding: 15px; margin-top: 15px; }
        
        /* --- NAV --- */
        .nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 80px; background: rgba(255,255,255,0.95); border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 50; backdrop-filter: blur(5px); }
        .nav-btn { background: none; border: none; display: flex; flex-direction: column; align-items: center; color: #64748b; font-size: 0.75rem; font-weight: 600; cursor: pointer; width: 100%; }
        .nav-btn i { font-size: 1.4rem; margin-bottom: 5px; }
        .nav-btn.active { color: var(--accent); }

        /* --- ONBOARDING --- */
        .onboarding-screen { position: fixed; inset: 0; background: white; z-index: 200; padding: 30px; display: flex; flex-direction: column; justify-content: center; }
        .inp { width: 100%; padding: 15px; margin-bottom: 20px; border: 1px solid var(--border); border-radius: 10px; font-size: 1.1rem; }
    </style>
</head>
<body>

    <div id="screen-onboarding" class="onboarding-screen hidden">
        <h1>Welcome to SilverStrength AI</h1>
        <p style="color:#64748b; margin-bottom:30px;">Optimized for weight loss & functional strength.</p>
        
        <label>Name</label>
        <input type="text" id="inp-name" class="inp" placeholder="Your Name">
        
        <label>Current Weight (lbs)</label>
        <input type="number" id="inp-weight" class="inp" placeholder="e.g. 200">
        
        <button class="btn btn-accent" onclick="finishOnboarding()">Start Transformation</button>
    </div>

    <div id="view-dashboard" class="container">
        <div class="header">
            <div>
                <h2 id="dash-greeting">Hello</h2>
                <div style="font-size:0.85rem; color:#64748b;" id="dash-date">Monday, Oct 24</div>
            </div>
            <div class="avatar"><i class="fas fa-user"></i></div>
        </div>

        <div class="stats-row">
            <div class="stat-box">
                <div class="stat-num" id="dash-weight">--</div>
                <div class="stat-lbl">Current Weight</div>
            </div>
            <div class="stat-box">
                <div class="stat-num" id="dash-workouts">0</div>
                <div class="stat-lbl">Sessions Done</div>
            </div>
        </div>

        <div id="ai-suggestion-area">
            </div>

        <h3 style="margin: 25px 0 15px 0;">Routine Library</h3>
        <div class="card">
            <div class="routine-item" onclick="previewRoutine('morning_metabolism')">
                <div>
                    <strong>Morning Metabolism</strong>
                    <div style="font-size:0.8rem; color:#64748b;">Cardio & Flow • 15 Mins</div>
                </div>
                <i class="fas fa-chevron-right" style="color:#cbd5e1;"></i>
            </div>
            <div class="routine-item" onclick="previewRoutine('strength_burn')">
                <div>
                    <strong>Full Body Burn</strong>
                    <div style="font-size:0.8rem; color:#64748b;">Strength & Resistance • 25 Mins</div>
                </div>
                <i class="fas fa-chevron-right" style="color:#cbd5e1;"></i>
            </div>
            <div class="routine-item" onclick="previewRoutine('evening_mobility')">
                <div>
                    <strong>Evening Recovery</strong>
                    <div style="font-size:0.8rem; color:#64748b;">Stretch & Joints • 12 Mins</div>
                </div>
                <i class="fas fa-chevron-right" style="color:#cbd5e1;"></i>
            </div>
        </div>
    </div>

    <div id="view-tracker" class="container hidden">
        <h2>Weight Trajectory</h2>
        <div class="card" style="height: 300px; margin-top:20px;">
            <canvas id="weightChart"></canvas>
        </div>
        <div class="card">
            <h3>Log Weigh-in</h3>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <input type="number" id="weight-log-input" class="inp" style="margin:0;" placeholder="lbs">
                <button class="btn btn-primary" style="width:auto;" onclick="logWeight()">Save</button>
            </div>
        </div>
    </div>

    <div id="view-active" class="hidden">
        <div class="active-header">
            <button class="btn-outline" style="width:auto; padding:8px 15px;" onclick="quitWorkout()">Quit</button>
            <div style="font-weight:bold;" id="act-title">Routine</div>
            <div style="width:50px;"></div>
        </div>
        <div class="active-body">
            <div style="text-align:center;">
                <span style="background:#e2e8f0; padding:4px 10px; border-radius:15px; font-size:0.75rem; font-weight:bold;">EXERCISE <span id="act-index">1</span></span>
                <h1 id="act-name" style="margin-top:10px; font-size:2rem; line-height:1.1;">Name</h1>
            </div>

            <div id="act-visual-area"></div>

            <div class="form-check-card">
                <div class="form-title"><i class="fas fa-check-circle"></i> Perfect Form</div>
                <ul class="form-list" id="act-cues"></ul>
                <div style="margin-top:10px; font-weight:bold; font-size:0.9rem; color:#0369a1;">Tempo: <span id="act-tempo" style="font-weight:normal;">2-0-2</span></div>
                <div style="font-weight:bold; font-size:0.9rem; color:#0369a1;">Breath: <span id="act-breath" style="font-weight:normal;">Exhale on push</span></div>
            </div>

            <div class="mistake-card">
                <div class="form-title" style="color:#b91c1c;"><i class="fas fa-exclamation-triangle"></i> Watch Out For</div>
                <ul class="form-list" id="act-mistakes" style="color:#7f1d1d;"></ul>
            </div>
            
            <div style="height: 100px;"></div> </div>
        <div style="position:fixed; bottom:0; width:100%; padding:20px; background:white; border-top:1px solid #e2e8f0;">
            <button class="btn btn-success" id="act-btn" onclick="nextExercise()">Start</button>
        </div>
    </div>

    <div class="nav">
        <button class="nav-btn active" onclick="switchTab('dashboard')">
            <i class="fas fa-home"></i> Coach
        </button>
        <button class="nav-btn" onclick="switchTab('tracker')">
            <i class="fas fa-chart-line"></i> Weight
        </button>
    </div>

    <script>
        /* --- 1. EXERCISE DATABASE (SMART CONTENT) --- */
        const library = {
            "Metabolic March": {
                type: "time", val: 60,
                cues: ["Lift knees to hip height", "Swing arms vigorously (cheek to cheek)", "Land softly on balls of feet"],
                mistakes: ["Slouching forward", "Stomping feet loudly", "Holding breath"],
                tempo: "Fast but controlled rhythm",
                breath: "Inhale 2 steps, Exhale 2 steps"
            },
            "Chair Squats": {
                type: "reps", val: 15,
                cues: ["Feet shoulder-width apart", "Tap bum to seat, don't fully sit", "Drive up through heels"],
                mistakes: ["Knees caving inward", "Looking down at feet (keeps chest down)", "Resting too long on the chair"],
                tempo: "3 sec down, 1 sec up (Explosive up)",
                breath: "Inhale down, Exhale up"
            },
            "Wall Push-ups": {
                type: "reps", val: 12,
                cues: ["Hands at chest height", "Body in straight plank line", "Elbows tucked 45 degrees (not flared)"],
                mistakes: ["Hips sagging", "Chin poking forward", "Shrugging shoulders to ears"],
                tempo: "2 sec down, 1 sec hold, 2 sec up",
                breath: "Inhale down, Exhale push"
            },
            "Sit-to-Stand Intervals": {
                type: "time", val: 45,
                cues: ["Stand up completely", "Sit down completely", "Repeat continuously"],
                mistakes: ["Using hands on knees to push up", "Flopping down onto the chair"],
                tempo: "Continuous motion, no pauses",
                breath: "Rhythmic breathing"
            },
            "Doorway Rows": {
                type: "reps", val: 15,
                cues: ["Hold doorframe, lean back", "Pull chest to doorframe", "Squeeze shoulder blades together"],
                mistakes: ["Leading with hips", "Pulling with biceps only"],
                tempo: "1 sec pull, 2 sec squeeze, 3 sec release",
                breath: "Exhale pull, Inhale release"
            },
            "Glute Bridges": {
                type: "reps", val: 15,
                cues: ["Lying on back, knees bent", "Lift hips until body is straight line", "Squeeze glutes hard at top"],
                mistakes: ["Arching lower back", "Pushing through toes (use heels)"],
                tempo: "1 sec up, 2 sec hold, 2 sec down",
                breath: "Exhale up, Inhale down"
            }
        };

        const routines = {
            'morning_metabolism': {
                name: "Morning Metabolism Spike",
                focus: "Fat Loss",
                exercises: ["Metabolic March", "Sit-to-Stand Intervals", "Metabolic March", "Doorway Rows", "Metabolic March"]
            },
            'strength_burn': {
                name: "Full Body Burn",
                focus: "Strength & Calorie Burn",
                exercises: ["Chair Squats", "Wall Push-ups", "Metabolic March", "Glute Bridges", "Doorway Rows", "Chair Squats"]
            },
            'evening_mobility': {
                name: "Evening Recovery",
                focus: "Joint Health",
                exercises: ["Glute Bridges", "Doorway Rows", "Metabolic March"] // Simplified for demo
            }
        };

        /* --- 2. STATE & STORAGE --- */
        let state = {
            user: { name: "", weight: 0 },
            logs: [], // { date: ISO, time: HH:MM, routine: ID }
            weightHistory: [],
            onboarded: false
        };

        let activeRoutine = null;
        let actIndex = 0;
        let timer = null;
        let timerVal = 0;
        let isPaused = false;
        let chart = null;

        /* --- 3. INIT --- */
        window.onload = () => {
            const saved = localStorage.getItem('SilverStrengthAI_v4');
            if (saved) state = JSON.parse(saved);
            
            if (!state.onboarded) {
                document.getElementById('screen-onboarding').classList.remove('hidden');
            } else {
                initDashboard();
            }
        };

        function save() {
            localStorage.setItem('SilverStrengthAI_v4', JSON.stringify(state));
        }

        function finishOnboarding() {
            const n = document.getElementById('inp-name').value;
            const w = document.getElementById('inp-weight').value;
            if(!n || !w) return alert("Required");
            state.user.name = n;
            state.user.weight = w;
            state.weightHistory.push({date: new Date().toLocaleDateString(), weight: w});
            state.onboarded = true;
            save();
            document.getElementById('screen-onboarding').classList.add('hidden');
            initDashboard();
        }

        /* --- 4. SMART COACH LOGIC --- */
        function initDashboard() {
            document.getElementById('dash-greeting').innerText = `Hello, ${state.user.name}`;
            document.getElementById('dash-date').innerText = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
            document.getElementById('dash-weight').innerText = state.user.weight;
            document.getElementById('dash-workouts').innerText = state.logs.length;

            generateRecommendation();
        }

        function generateRecommendation() {
            const now = new Date();
            const hour = now.getHours();
            const todayStr = now.toISOString().split('T')[0];
            
            // Check if user worked out today
            const workoutsToday = state.logs.filter(l => l.date.startsWith(todayStr));
            
            let recHTML = "";
            let recRoutine = "";

            if (workoutsToday.length === 0) {
                // No workout yet today
                if (hour < 11) {
                    recRoutine = 'morning_metabolism';
                    recHTML = `
                        <div class="ai-badge">Morning Focus</div>
                        <h2>Metabolic Jumpstart</h2>
                        <div class="ai-reason">
                            It's morning! This short routine uses interval movements to wake up your metabolism and burn more calories throughout the day.
                        </div>
                        <button class="btn btn-accent" style="margin-top:15px; background:white; color:var(--primary);" onclick="startWorkout('${recRoutine}')">Start Now</button>
                    `;
                } else if (hour >= 11 && hour < 18) {
                    recRoutine = 'strength_burn';
                    recHTML = `
                        <div class="ai-badge">Afternoon Burn</div>
                        <h2>Full Body Strength</h2>
                        <div class="ai-reason">
                            Your body temperature is highest now, making it the safest time for resistance training. Let's build muscle to burn fat.
                        </div>
                        <button class="btn btn-accent" style="margin-top:15px; background:white; color:var(--primary);" onclick="startWorkout('${recRoutine}')">Start Now</button>
                    `;
                } else {
                    recRoutine = 'evening_mobility';
                    recHTML = `
                        <div class="ai-badge">Evening Routine</div>
                        <h2>Mobility & Digestion</h2>
                        <div class="ai-reason">
                            A light routine now helps digestion and prepares joints for sleep without spiking cortisol levels.
                        </div>
                        <button class="btn btn-accent" style="margin-top:15px; background:white; color:var(--primary);" onclick="startWorkout('${recRoutine}')">Start Now</button>
                    `;
                }
            } else {
                // User HAS worked out today
                const lastType = workoutsToday[workoutsToday.length-1].routine;
                if (lastType === 'morning_metabolism' && hour > 16) {
                    // Double day suggestion
                    recRoutine = 'evening_mobility';
                    recHTML = `
                        <div class="ai-badge" style="background:var(--success)">Great Job Today</div>
                        <h2>Bonus: Evening Flow</h2>
                        <div class="ai-reason">
                            You crushed your morning session. Adding a 10-minute mobility flow now will double your results by keeping you active.
                        </div>
                        <button class="btn btn-success" style="margin-top:15px;" onclick="startWorkout('${recRoutine}')">Start Bonus</button>
                    `;
                } else {
                    recHTML = `
                        <div style="text-align:center;">
                            <i class="fas fa-check-circle" style="font-size:3rem; color:var(--success);"></i>
                            <h2>Daily Goal Met!</h2>
                            <p style="opacity:0.8">Rest and hydrate. See you tomorrow.</p>
                        </div>
                    `;
                }
            }

            const box = document.getElementById('ai-suggestion-area');
            box.className = 'ai-rec-box';
            box.innerHTML = recHTML;
        }

        /* --- 5. WORKOUT ENGINE --- */
        function previewRoutine(id) {
            if(confirm(`Start ${routines[id].name}?`)) startWorkout(id);
        }

        function startWorkout(id) {
            activeRoutine = routines[id];
            actIndex = 0;
            document.getElementById('view-active').classList.remove('hidden');
            document.getElementById('act-title').innerText = activeRoutine.name;
            loadExercise();
        }

        function loadExercise() {
            if (actIndex >= activeRoutine.exercises.length) {
                finishWorkout();
                return;
            }

            const exName = activeRoutine.exercises[actIndex];
            const data = library[exName];

            document.getElementById('act-index').innerText = `${actIndex + 1} / ${activeRoutine.exercises.length}`;
            document.getElementById('act-name').innerText = exName;
            
            // Populate Guides
            const cuesList = document.getElementById('act-cues');
            cuesList.innerHTML = data.cues.map(c => `<li>${c}</li>`).join('');
            
            const mistList = document.getElementById('act-mistakes');
            mistList.innerHTML = data.mistakes.map(m => `<li>${m}</li>`).join('');

            document.getElementById('act-tempo').innerText = data.tempo;
            document.getElementById('act-breath').innerText = data.breath;

            // Visual Area
            const viz = document.getElementById('act-visual-area');
            const btn = document.getElementById('act-btn');
            
            clearInterval(timer);

            if (data.type === 'reps') {
                viz.innerHTML = `<div class="rep-big">${data.val}<span style="font-size:1.5rem"> reps</span></div>`;
                btn.innerText = "Completed";
                btn.className = "btn btn-success";
                btn.onclick = nextExercise;
            } else {
                timerVal = data.val;
                isPaused = false;
                viz.innerHTML = `<div class="timer-big" id="timer-disp">00:${timerVal}</div>`;
                btn.innerText = "Start Timer";
                btn.className = "btn btn-primary";
                btn.onclick = toggleTimer;
            }
        }

        function toggleTimer() {
            const btn = document.getElementById('act-btn');
            if (btn.innerText === "Start Timer") {
                btn.innerText = "Pause";
                startTimerLoop();
            } else if (btn.innerText === "Pause") {
                isPaused = true;
                btn.innerText = "Resume";
            } else {
                isPaused = false;
                btn.innerText = "Pause";
            }
        }

        function startTimerLoop() {
            timer = setInterval(() => {
                if (!isPaused) {
                    timerVal--;
                    document.getElementById('timer-disp').innerText = `00:${timerVal.toString().padStart(2,'0')}`;
                    if (timerVal <= 0) {
                        clearInterval(timer);
                        if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
                        nextExercise();
                    }
                }
            }, 1000);
        }

        function nextExercise() {
            actIndex++;
            loadExercise();
        }

        function quitWorkout() {
            if(confirm("Quit?")) {
                clearInterval(timer);
                document.getElementById('view-active').classList.add('hidden');
            }
        }

        function finishWorkout() {
            clearInterval(timer);
            document.getElementById('view-active').classList.add('hidden');
            
            // Log it
            state.logs.push({
                date: new Date().toISOString(),
                routine: Object.keys(routines).find(key => routines[key] === activeRoutine)
            });
            save();
            initDashboard();
            alert("Workout Complete! Weight loss progress logged.");
        }

        /* --- 6. WEIGHT TRACKING --- */
        function switchTab(tab) {
            document.getElementById('view-dashboard').classList.add('hidden');
            document.getElementById('view-tracker').classList.add('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

            if (tab === 'dashboard') {
                document.getElementById('view-dashboard').classList.remove('hidden');
                document.querySelector('.nav-btn:nth-child(1)').classList.add('active');
                initDashboard();
            } else {
                document.getElementById('view-tracker').classList.remove('hidden');
                document.querySelector('.nav-btn:nth-child(2)').classList.add('active');
                renderChart();
            }
        }

        function logWeight() {
            const val = document.getElementById('weight-log-input').value;
            if(!val) return;
            state.user.weight = val;
            state.weightHistory.push({ date: new Date().toLocaleDateString(), weight: val });
            save();
            document.getElementById('weight-log-input').value = "";
            renderChart();
            alert("Weight logged");
        }

        function renderChart() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            if (chart) chart.destroy();
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: state.weightHistory.map(x => x.date),
                    datasets: [{
                        label: 'Weight',
                        data: state.weightHistory.map(x => x.weight),
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }
    </script>
</body>
</html>
